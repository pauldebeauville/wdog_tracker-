name: WDOG Multi-Tracker Bot

on:
  schedule:
    - cron: "*/2 * * * *"   # toutes les 2 minutes
  workflow_dispatch:

# ðŸ‘‰ Par dÃ©faut, on travaille dans le sous-dossier Snipe-Wdog
defaults:
  run:
    working-directory: Snipe-Wdog

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      # (optionnel) debug pour vÃ©rifier qu'on est bien dans le bon dossier
      - name: Debug workspace
        run: |
          pwd
          ls -la
          node -v

      - name: Install dependencies
        # utilise le lock si prÃ©sent, sinon npm install
        run: |
          if [ -f package-lock.json ]; then
            npm ci
          else
            npm install
          fi

      - name: Run WDOG bot
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          RPC_ENDPOINT: https://solana-rpc.publicnode.com
          # PING_URL inutile sur Actions, on le laisse vide
          PING_URL: ""
        run: node watch-wdog.js
